<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Resume Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1d4ed8',
                        secondary: '#4f46e5',
                        accent: '#f97316',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #000000;
        }
        .resume-preview-container {
            max-width: 8.5in;
            margin: 2rem auto;
            padding: 1.5in 0.75in;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-height: 11in;
            box-sizing: border-box;
            color: #333;
        }
        @media print {
            body { margin: 0; padding: 0; background-color: white; }
            .resume-preview-container {
                box-shadow: none;
                margin: 0;
                padding: 1in 0.75in;
                width: 8.5in;
                min-height: 11in;
            }
            .resume-content-base p, .resume-content-base ul, .resume-content-base .contact-info, .resume-content-base .dates, .resume-content-base .location { font-size: 10.5pt; }
            .template-modern h1 { font-size: 19pt; }
            .template-modern h2 { font-size: 13pt; }
            .template-classic h1 { font-size: 20pt; }
            .template-classic h2 { font-size: 12pt; }
            .template-minimalist h1 { font-size: 18pt; }
            .template-minimalist h2 { font-size: 11pt; }
            .resume-content-base .job-title, .resume-content-base .company, .resume-content-base .degree, .resume-content-base .institution { font-size: 11.5pt; }
            .template-minimalist ul li::before { font-size: 10.5pt; }
        }
        .resume-content-base h1 { font-weight: bold; margin-bottom: 0.25em; }
        .resume-content-base h2 { font-weight: bold; padding-bottom: 0.25em; margin-top: 1.5em; margin-bottom: 0.75em; }
        .resume-content-base p, .resume-content-base ul { font-size: 0.95em; line-height: 1.4; margin-bottom: 0.5em; }
        .resume-content-base ul { list-style-type: disc; margin-left: 1.5em; }
        .resume-content-base ul li { margin-bottom: 0.25em; }
        .resume-content-base .contact-info { font-size: 0.9em; color: #555; margin-bottom: 1em; }
        .resume-content-base .experience-item, .resume-content-base .education-item { margin-bottom: 1em; }
        .resume-content-base .job-title, .resume-content-base .company, .resume-content-base .degree, .resume-content-base .institution { font-weight: 600; }
        .resume-content-base .dates, .resume-content-base .location { font-size: 0.85em; color: #666; }
        .resume-content-base a { color: #3498db; text-decoration: none; }
        .resume-content-base a:hover { text-decoration: underline; }
        .template-modern h1 { font-size: 1.8em; text-align: center; color: #2c3e50; }
        .template-modern h2 { font-size: 1.2em; color: #2c3e50; border-bottom: 2px solid #3498db; }
        .template-modern .contact-info { text-align: center; }
        .template-classic h1 { font-size: 1.9em; color: #333; text-transform: uppercase; letter-spacing: 0.05em; text-align: left; border-bottom: 1px solid #ccc; padding-bottom: 0.5em; margin-bottom: 1em; }
        .template-classic h2 { font-size: 1.1em; color: #333; border-bottom: 1px solid #ccc; text-align: left; text-transform: uppercase; }
        .template-classic .contact-info { text-align: left; margin-bottom: 0.5em; }
        .template-classic .experience-item, .template-classic .education-item { border-left: 3px solid #ddd; padding-left: 10px; margin-left: 5px; }
        .template-classic ul { list-style-type: square; }
        .template-minimalist h1 { font-size: 1.8em; text-align: center; color: #333; margin-bottom: 0.5em; }
        .template-minimalist h2 { font-size: 1.1em; color: #555; margin-top: 1.5em; margin-bottom: 0.5em; border-bottom: none; text-transform: uppercase; letter-spacing: 0.03em; }
        .template-minimalist .contact-info { text-align: center; font-size: 0.85em; margin-bottom: 1.5em; }
        .template-minimalist p, .template-minimalist ul { font-size: 0.9em; }
        .template-minimalist ul { list-style-type: none; margin-left: 0; padding-left: 1.5em; }
        .template-minimalist ul li::before { content: '– '; margin-left: -1.5em; display: inline-block; width: 1.5em; }
        .template-minimalist .experience-item, .template-minimalist .education-item { margin-bottom: 1.2em; }
        .template-minimalist .job-title, .template-minimalist .degree { font-weight: 700; color: #222; }
        .template-minimalist .company, .template-minimalist .institution { font-weight: normal; font-style: italic; }
        .template-minimalist .dates, .template-minimalist .location { color: #777; font-size: 0.8em; margin-top: 0.2em; }
        .ats-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        .ats-modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .ats-modal-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        .ats-modal-overlay.visible .ats-modal-content {
            transform: translateY(0);
        }
        .ats-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: color 0.2s;
        }
        .ats-modal-close:hover { color: #333; }
        .ats-modal-content h3 { font-size: 1.5rem; font-weight: bold; color: #3498db; margin-bottom: 1.25rem; text-align: center; border-bottom: 2px solid #e0e0e0; padding-bottom: 0.75rem; }
        .ats-modal-content h4 { font-size: 1.1rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #2c3e50; }
        .ats-modal-content ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .ats-modal-content ol { list-style-type: decimal; margin-left: 1.5rem; margin-bottom: 1rem; }
        .ats-modal-content p { margin-bottom: 0.75rem; line-height: 1.6; }
        .ats-modal-content .status-good { color: #28a745; font-weight: bold; }
        .ats-modal-content .status-warning { color: #ffc107; font-weight: bold; }
        .ats-modal-content .status-bad { color: #dc3545; font-weight: bold; }
        .suggestion-chip {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            background-color: #374151;
            border-radius: 9999px;
            cursor: pointer;
            font-size: 0.875rem;
            color: #ffffff;
            transition: background-color 0.2s;
        }
        .suggestion-chip:hover { background-color: #4b5563; }
        .progress-bar {
            height: 8px;
            background-color: #374151;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: #4caf50;
            transition: width 0.6s ease-in-out;
        }
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .collapsible-content { display: none; }
        .collapsible-content.active { display: block; }
        .wizard-section { display: none; }
        .wizard-section.active { display: block; }
        .navbar {
            background-color: #1f2937;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 7xl;
            margin: 0 auto;
            padding: 1rem 1.5rem;
        }
        .navbar-logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1d4ed8;
        }
        .navbar-menu {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        .navbar-menu a {
            color: #d1d5db;
            font-weight: 500;
            transition: color 0.2s;
        }
        .navbar-menu a:hover {
            color: #1d4ed8;
        }
        .navbar-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .mobile-menu {
            display: none;
            color: #d1d5db;
        }
        @media (max-width: 768px) {
            .navbar-menu {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: #1f2937;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                padding: 1rem;
            }
            .navbar-menu.active {
                display: flex;
            }
            .mobile-menu {
                display: block;
                cursor: pointer;
                font-size: 1.5rem;
                color: #1d4ed8;
            }
        }
        .skill-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #1f2937;
            border-radius: 8px;
            cursor: move;
        }
        .skill-item.dragging {
            opacity: 0.5;
        }
        .skill-item span {
            flex-grow: 1;
            color: #ffffff;
        }
        .star-rating {
            display: flex;
            gap: 0.25rem;
            margin-left: 1rem;
        }
        .star {
            color: #d1d5db;
            cursor: pointer;
        }
        .star.filled {
            color: #f97316;
        }
        .category-select, .proficiency-select {
            background-color: #374151;
            color: #ffffff;
            border: 1px solid #4b5563;
            padding: 0.5rem;
            border-radius: 4px;
        }
        .category-select:focus, .proficiency-select:focus {
            outline: none;
            ring: 2px solid #1d4ed8;
        }
        .template-option.active {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        .color-option.active {
            border-color: white !important;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
        }
        .step-connector {
            transition: background-color 0.3s ease;
        }
        .step-icon {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .step-label {
            transition: color 0.3s ease;
        }
       /*added content*/ 
        #livePreview {
            max-width: 100%;
            overflow-x: auto;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #livePreview .resume-content-base {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 1in 0.75in;
            box-sizing: border-box;
        }

        #livePreview h1 {
            font-size: 2em;
            margin-bottom: 0.5em;
            text-align: center;
        }

        #livePreview h2 {
            font-size: 1.5em;
            margin-top: 1em;
            margin-bottom: 0.5em;
            border-bottom: 2px solid #000;
            padding-bottom: 0.2em;
        }

        #livePreview h3 {
            font-size: 1.2em;
            margin-top: 0.5em;
            margin-bottom: 0.2em;
        }

        #livePreview p {
            margin: 0.5em 0;
            line-height: 1.6;
            word-wrap: break-word;
        }

        #livePreview ul {
            margin: 0.5em 0;
            padding-left: 20px;
        }

        #livePreview ul li {
            margin: 0.2em 0;
        }

        #livePreview a {
            color: #1e40af;
            text-decoration: none;
        }

        #livePreview a:hover {
            text-decoration: underline;
        }
        #downloadPdfBtn, #downloadHtmlBtn, #copyForWordBtn, #checkAtsBtn {
            transition: all 0.2s ease;
            transform: translateY(0);
        }
        #downloadPdfBtn:hover, #downloadHtmlBtn:hover, #copyForWordBtn:hover, #checkAtsBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #downloadPdfBtn:active, #downloadHtmlBtn:active, #copyForWordBtn:active, #checkAtsBtn:active {
            transform: translateY(0);
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .navbar-container {
                padding: 0.75rem 1rem;
            }
            .navbar-logo {
                font-size: 1.25rem;
            }
        }

        .ats-modal-content {
    background-color: #1f2937;
    color: white;
    border: 1px solid #4b5563;
}

.ats-modal-content h3 {
    color: #3b82f6;
    border-bottom-color: #4b5563;
}

.ats-modal-content h4 {
    color: #e5e7eb;
}

.ats-modal-content .status-good {
    color: #34d399;
}

.ats-modal-content .status-warning {
    color: #fbbf24;
}

.ats-modal-content .status-bad {
    color: #f87171;
}

.ats-modal-close {
    color: #9ca3af;
}
.ats-modal-close:hover {
    color: #f3f4f6;
}

    </style>
</head>
<body class="font-inter text-gray-200">
    <!-- Header Section -->
    <nav class="navbar">
        <div class="navbar-container">
            <!-- Logo -->
            <div class="navbar-logo">ResumeCraft</div>
            <!-- Menu Items -->
            <div class="navbar-menu" id="navbarMenu">
                <a href="#home">Home</a>
                <a href="#features">Features</a>
                <a href="#pricing">Pricing</a>
                <a href="#support">Support</a>
                <a href="#get-started" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-blue-600 transition duration-200">Get Started</a>
            </div>
            <!-- Login/Signup -->
            <div class="navbar-actions">
                <a href="#login" class="text-gray-400 hover:text-primary">Login</a>
                <a href="#signup" class="px-4 py-2 bg-secondary text-white rounded-md hover:bg-indigo-600 transition duration-200">Sign Up</a>
            </div>
            <!-- Mobile Menu Toggle -->
            <div class="mobile-menu" id="mobileMenuToggle">☰</div>
        </div>
    </nav>
    <!-- Main Content -->
    <div class="container mx-auto max-w-7xl p-6 pt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column: Form Wizard -->
        <div class="lg:col-span-2 bg-gray-800 p-6 rounded-xl shadow-lg">
            <h1 class="text-3xl font-bold text-center mb-6 text-blue-500">Resume Builder</h1>
            <!-- Progress Steps -->
            <div class="flex justify-between mb-6">
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center step-personal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <span class="text-xs mt-1 text-primary font-medium step-personal-label">Personal</span>
                </div>
                <div class="flex-1 flex items-center mx-2">
                    <div class="h-1 w-full bg-primary"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center step-experience">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <span class="text-xs mt-1 text-primary font-medium step-experience-label">Experience</span>
                </div>
                <div class="flex-1 flex items-center mx-2">
                    <div class="h-1 w-full bg-primary"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center step-education">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                    </div>
                    <span class="text-xs mt-1 text-primary font-medium step-education-label">Education</span>
                </div>
                <div class="flex-1 flex items-center mx-2">
                    <div class="h-1 w-full bg-gray-600"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center step-skills">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                    <span class="text-xs mt-1 text-gray-400 step-skills-label">Skills</span>
                </div>
                <div class="flex-1 flex items-center mx-2">
                    <div class="h-1 w-full bg-gray-600"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center step-extra">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </div>
                    <span class="text-xs mt-1 text-gray-400 step-extra-label">Extra</span>
                </div>
            </div>


            <!-- ATS Compatibility Score -->
            <div class="mb-6 p-4 bg-gray-700 rounded-lg border border-blue-500">
                <div class="flex items-center justify-between">
                    <p class="text-sm font-semibold text-gray-200">ATS Compatibility Score:</p>
                    <div class="flex items-center gap-2">
                        <span id="atsScore" class="text-lg font-bold text-blue-400">0/100</span>
                        <div class="w-16 h-4 bg-gray-600 rounded-full overflow-hidden">
                            <div id="atsScoreBar" class="h-full bg-gradient-to-r from-blue-500 to-green-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <p class="text-xs text-gray-400 mt-1">Higher scores perform better with applicant tracking systems</p>
            </div>


            <!-- Form Wizard -->
            <form id="resumeForm" class="space-y-4">
                <!-- Step 1: Personal Information -->
                <section id="step-1" class="wizard-section active">
                    <div class="bg-gray-700 p-4 rounded-lg shadow-sm mb-4">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h2 class="text-blue-400">Personal Information</h2>
                            <span class="text-blue-500">↓</span>
                        </div>
                        <div class="collapsible-content active">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                                <div>
                                    <input type="text" id="fullName" placeholder="Full Name" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200" required>
                                    <div id="fullNameSuggestions" class="mt-2"></div>
                                </div>
                                <div>
                                    <input type="email" id="email" placeholder="Email Address" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200" required>
                                    <div id="emailSuggestions" class="mt-2"></div>
                                </div>
                                <div>
                                    <input type="tel" id="phone" placeholder="Phone Number" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                                    <div id="phoneSuggestions" class="mt-2"></div>
                                </div>
                                <div>
                                    <input type="url" id="linkedin" placeholder="LinkedIn Profile URL" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                                    <div id="linkedinSuggestions" class="mt-2"></div>
                                </div>
                                <div>
                                    <input type="url" id="portfolio" placeholder="Portfolio URL (Optional)" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                                    <div id="portfolioSuggestions" class="mt-2"></div>
                                </div>
                                <div class="col-span-2">
                                    <textarea id="summary" placeholder="Brief Professional Summary (2-3 sentences, max 200 chars)" rows="3" maxlength="200" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"></textarea>
                                    <div id="summarySuggestions" class="mt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Step 2: Work Experience and Job Description -->
                <section id="step-2" class="wizard-section">
                    <div class="bg-green-900 p-4 rounded-lg shadow-sm mb-4">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h2 class="text-green-400">Work Experience</h2>
                            <span class="text-green-500">↓</span>
                        </div>
                        <div class="collapsible-content active">
                            <p class="text-sm text-green-300 mb-2">Focus on <strong>achievements</strong> and <strong>quantifiable results</strong>! Use the STAR/PAR method.</p>
                            <div id="experienceContainer" class="space-y-4">
                                <div class="experience-item p-4 border border-green-700 rounded-md bg-gray-900">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                        <input type="text" class="exp-title input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Job Title" required>
                                        <div class="exp-title-suggestions mt-2"></div>
                                        <input type="text" class="exp-company input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Company Name" required>
                                        <div class="exp-company-suggestions mt-2"></div>
                                        <input type="text" class="exp-location input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Location (City, State/Country)">
                                        <div class="exp-location-suggestions mt-2"></div>
                                        <div class="flex gap-2">
                                            <input type="month" class="exp-start-date input-field p-3 border border-gray-600 rounded-md w-1/2 bg-gray-900 text-gray-200" placeholder="Start Date (MM/YYYY)" required>
                                            <input type="month" class="exp-end-date input-field p-3 border border-gray-600 rounded-md w-1/2 bg-gray-900 text-gray-200" placeholder="End Date (MM/YYYY) or Present" required>
                                        </div>
                                    </div>
                                    <textarea class="exp-achievements input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" rows="4" placeholder="Describe 3-5 key achievements with quantifiable results. One per line." required></textarea>
                                    <div class="exp-achievements-suggestions mt-2"></div>
                                    <button type="button" class="remove-exp-btn mt-2 px-3 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">Remove Experience</button>
                                </div>
                            </div>
                            <button type="button" id="addExperienceBtn" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 shadow-md">Add Another Experience</button>
                        </div>
                    </div>
                    <div class="bg-yellow-900 p-4 rounded-lg shadow-sm">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h2 class="text-yellow-400">Job Description Keywords (Optional)</h2>
                            <span class="text-yellow-500">↓</span>
                        </div>
                        <div class="collapsible-content active">
                            <p class="text-sm text-yellow-300 mb-2">Paste a job description to get keyword suggestions.</p>
                            <textarea id="jobDescription" placeholder="Paste the job description here..." rows="5" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"></textarea>
                            <div id="keywordSuggestions" class="mt-3 p-3 bg-yellow-800 rounded-md text-sm text-yellow-200 hidden">
                                <h3 class="font-semibold mb-1">Suggested Keywords:</h3>
                                <p id="suggestedKeywordsList"></p>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Step 3: Education and Skills -->
                <section id="step-3" class="wizard-section">
                    <div class="bg-purple-900 p-4 rounded-lg shadow-sm mb-4">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h2 class="text-purple-400">Education</h2>
                            <span class="text-purple-500">↓</span>
                        </div>
                        <div class="collapsible-content active">
                            <div id="educationContainer" class="space-y-4">
                                <div class="education-item p-4 border border-purple-700 rounded-md bg-gray-900">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                        <input type="text" class="edu-degree input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Degree/Certificate" required>
                                        <div class="edu-degree-suggestions mt-2"></div>
                                        <input type="text" class="edu-institution input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Institution Name" required>
                                        <div class="edu-institution-suggestions mt-2"></div>
                                        <input type="text" class="edu-major input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Major/Field of Study">
                                        <div class="edu-major-suggestions mt-2"></div>
                                        <input type="month" class="edu-grad-date input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Graduation Date (MM/YYYY) or Expected" required>
                                    </div>
                                    <button type="button" class="remove-edu-btn mt-2 px-3 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">Remove Education</button>
                                </div>
                            </div>
                            <button type="button" id="addEducationBtn" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 shadow-md">Add Another Education</button>
                        </div>
                    </div>
                    <div class="bg-orange-900 p-4 rounded-lg shadow-sm">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h2 class="text-orange-400">Skills Management</h2>
                            <span class="text-orange-500">↓</span>
                        </div>
                        <div class="collapsible-content active">
                            <!-- ATS Skills Score -->
                            <div class="mb-4">
                                <p class="text-sm font-semibold text-gray-200">Skills ATS Compatibility: <span id="skillsAtsScore" class="font-bold text-green-500">0%</span></p>
                                <div class="progress-bar mt-1">
                                    <div id="skillsAtsScoreBar" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <!-- Technical Skills -->
                             <div class="mb-6">
                                <h3 class="text-lg font-semibold text-orange-300 mb-2">Technical Skills</h3>
                                <div class="flex gap-2 mb-3">
                                    <select id="techSkillCategory" class="category-select w-1/3">
                                        <option value="Programming Languages">Programming Languages</option>
                                        <option value="Frameworks">Frameworks</option>
                                        <option value="Tools">Tools</option>
                                        <option value="Databases">Databases</option>
                                    </select>
                                    <input type="text" id="techSkillInput" placeholder="Add skill (e.g., Python)" class="p-3 border border-gray-600 rounded-md w-1/2 bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button type="button" id="addTechSkillBtn" class="px-3 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700">Add</button>
                                </div>
                                <div id="techSkillsContainer" class="space-y-2" draggable="true"></div>
                            </div>
                             <!-- Soft Skills -->
                            <div>
                                <h3 class="text-lg font-semibold text-orange-300 mb-2">Soft Skills</h3>
                                <div class="flex gap-2 mb-3">
                                    <select id="softSkillSelect" class="category-select w-1/3">
                                        <option value="">Select a skill</option>
                                        <option value="Communication">Communication</option>
                                        <option value="Teamwork">Teamwork</option>
                                        <option value="Problem Solving">Problem Solving</option>
                                        <option value="Leadership">Leadership</option>
                                    </select>
                                    <input type="text" id="customSoftSkillInput" placeholder="Custom skill" class="p-3 border border-gray-600 rounded-md w-1/3 bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <select id="softSkillProficiency" class="proficiency-select w-1/3">
                                        <option value="Beginner">Beginner</option>
                                        <option value="Intermediate">Intermediate</option>
                                        <option value="Advanced">Advanced</option>
                                    </select>
                                    <button type="button" id="addSoftSkillBtn" class="px-3 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700">Add</button>
                                </div>
                                <div id="softSkillsContainer" class="space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Step 4: Additional Sections -->
                <section id="step-4" class="wizard-section">
                    <div class="bg-cyan-900 p-4 rounded-lg shadow-sm">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h2 class="text-cyan-400">Additional Sections</h2>
                            <span class="text-cyan-500">↓</span>
                        </div>
                        <div class="collapsible-content active">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-200">Certifications</label>
                                    <textarea id="certifications" placeholder="List certifications (e.g., PMP, AWS Certified Solutions Architect)" rows="3" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"></textarea>
                                    <div id="certificationsSuggestions" class="mt-2"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-200">Projects</label>
                                    <textarea id="projects" placeholder="List notable projects (e.g., Developed a web app using React)" rows="3" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"></textarea>
                                    <div id="projectsSuggestions" class="mt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <input type="hidden" id="skills" name="skills">
                <!-- Navigation Buttons -->
                <div class="flex justify-between mt-6">
                    <button type="button" id="prevButton" class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 disabled:opacity-50" disabled>Previous</button>
                    <button type="button" id="nextButton" class="px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Next</button>
                    <button type="submit" id="submitButton" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 hidden">Generate Resume</button>
                </div>
            </form>
        </div>
        <!-- Right Column: Preview and Customization -->
        <div class="lg:col-span-1 bg-gray-800 p-6 rounded-xl shadow-lg sticky top-20">
            <h2 class="text-xl font-bold mb-4 text-gray-200">Resume Preview & Customization</h2>
            <!-- Hidden inputs for state management -->
            <input type="hidden" id="templateSelector" value="modern">
            <input type="hidden" id="primaryColor" value="#1d4ed8">
            <input type="hidden" id="layout" value="standard">

            <!-- Template Selector -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-200">Template</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button class="template-option px-4 py-3 bg-gray-700 rounded-lg text-center border-2 border-transparent hover:border-blue-500 transition-colors active" data-template="modern">
                        <div class="h-20 bg-white rounded mb-2"></div>
                        <span class="text-gray-200">Modern</span>
                    </button>
                    <button class="template-option px-4 py-3 bg-gray-700 rounded-lg text-center border-2 border-transparent hover:border-blue-500 transition-colors" data-template="classic">
                        <div class="h-20 bg-white rounded mb-2"></div>
                        <span class="text-gray-200">Classic</span>
                    </button>
                    <button class="template-option px-4 py-3 bg-gray-700 rounded-lg text-center border-2 border-transparent hover:border-blue-500 transition-colors" data-template="creative">
                        <div class="h-20 bg-white rounded mb-2"></div>
                        <span class="text-gray-200">Creative</span>
                    </button>
                    <button class="template-option px-4 py-3 bg-gray-700 rounded-lg text-center border-2 border-transparent hover:border-blue-500 transition-colors" data-template="minimalist">
                        <div class="h-20 bg-white rounded mb-2"></div>
                        <span class="text-gray-200">Minimalist</span>
                    </button>
                </div>
            </div>

            <!-- Color Scheme -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-200">Color Scheme</h3>
                <div class="grid grid-cols-5 gap-2">
                    <button class="color-option h-10 rounded-full bg-blue-600 border-2 border-transparent hover:border-white active" data-color="#1d4ed8"></button>
                    <button class="color-option h-10 rounded-full bg-purple-600 border-2 border-transparent hover:border-white" data-color="#7c3aed"></button>
                    <button class="color-option h-10 rounded-full bg-green-600 border-2 border-transparent hover:border-white" data-color="#059669"></button>
                    <button class="color-option h-10 rounded-full bg-red-600 border-2 border-transparent hover:border-white" data-color="#dc2626"></button>
                    <button class="color-option h-10 rounded-full bg-gray-600 border-2 border-transparent hover:border-white" data-color="#4b5563"></button>
                </div>
            </div>

            <!-- Font Style -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-200">Font Style</h3>
                <select id="fontFamily" class="p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="Inter">Inter</option>
                    <option value="Arial">Arial</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Courier New">Courier New</option>
                </select>
            </div>
            
            <!-- Font Size -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-200">Font Size</h3>
                <input type="range" id="fontSize" min="10" max="14" value="12" class="w-full">
                <div class="flex justify-between text-sm text-gray-400">
                    <span>Small</span>
                    <span>Medium</span>
                    <span>Large</span>
                </div>
            </div>
            <!-- Spacing -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-200">Spacing</h3>
                <input type="range" id="lineSpacing" min="1" max="2" step="0.1" value="1.4" class="w-full">
                <div class="flex justify-between text-sm text-gray-400">
                    <span>Compact</span>
                    <span>Standard</span>
                    <span>Spacious</span>
                </div>
            </div>
            
            <!-- Live Preview -->
            <div id="livePreview" class="resume-preview-container mt-4 overflow-y-auto max-h-[400px]">
                <p class="text-center text-gray-500">Live preview will update as you fill out the form.</p>
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-6 grid grid-cols-2 gap-3">
                <button id="downloadPdfBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors text-sm sm:text-base">
                    <span class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        PDF
                    </span>
                </button>
                <button id="downloadHtmlBtn" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm sm:text-base">
                    <span class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        HTML
                    </span>
                </button>
                <button id="copyForWordBtn" class="px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition-colors text-sm sm:text-base col-span-2">
                    <span class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                        </svg>
                        Copy for Word
                    </span>
                </button>
                <button id="checkAtsBtn" class="px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 transition-colors text-sm sm:text-base col-span-2">
                    <span class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        Check ATS
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- ATS Compatibility Modal -->
    <div id="atsModalOverlay" class="ats-modal-overlay">
        <div class="ats-modal-content">
            <button class="ats-modal-close" id="closeAtsModal">×</button>
            <h3>ATS Compatibility Report</h3>
            <h4>General ATS Best Practices:</h4>
            <ol>
                <li><p><strong>Keywords:</strong> Use keywords directly from the job description.</p></li>
                <li><p><strong>Clear Headings:</strong> Use standard headings like "Experience", "Education", "Skills".</p></li>
                <li><p><strong>Quantify Achievements:</strong> Use numbers, percentages, and metrics.</p></li>
                <li><p><strong>Simple Formatting:</strong> Avoid complex tables or graphics.</p></li>
                <li><p><strong>Reverse Chronological Order:</strong> List experience and education from most recent.</p></li>
                <li><p><strong>Consistent Formatting:</strong> Ensure uniform dates and titles.</p></li>
                <li><p><strong>Proofread:</strong> Avoid typos and grammatical errors.</p></li>
            </ol>
            <h4>Your Resume Analysis:</h4>
            <div id="atsAnalysisResults">
                <p>Click 'Generate Resume' first, then check ATS compatibility.</p>
            </div>
        </div>
    </div>

    <script>
        // Utility Functions
        function escapeHTML(str) {
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

        function toggleCollapsible(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('span');
            content.classList.toggle('active');
            arrow.textContent = content.classList.contains('active') ? '↑' : '↓';
        }

        // Form Wizard Navigation
        let currentStep = 1;
        const totalSteps = 4;

        function updateProgressSteps(currentStep) {
            const steps = [
                { icon: document.querySelector('.step-personal'), label: document.querySelector('.step-personal-label') },
                { icon: document.querySelector('.step-experience'), label: document.querySelector('.step-experience-label') },
                { icon: document.querySelector('.step-education'), label: document.querySelector('.step-education-label') },
                { icon: document.querySelector('.step-skills'), label: document.querySelector('.step-skills-label') },
                { icon: document.querySelector('.step-extra'), label: document.querySelector('.step-extra-label') }
            ];

            // Reset all steps
            steps.forEach((step, index) => {
                if (step.icon && step.label) {
                    step.icon.classList.remove('bg-primary', 'text-white');
                    step.icon.classList.add('bg-gray-600', 'text-gray-300');
                    step.label.classList.remove('text-primary', 'font-medium');
                    step.label.classList.add('text-gray-400');
                    // Update the line after this step (if not the last step)
                    if (index < steps.length - 1) {
                        const nextLine = step.icon.closest('.flex').nextElementSibling.querySelector('.h-1');
                        if (nextLine) {
                            nextLine.classList.remove('bg-primary');
                            nextLine.classList.add('bg-gray-600');
                        }
                    }
                }
            });

            // Activate completed steps
            for (let i = 0; i < currentStep; i++) {
                if (steps[i] && steps[i].icon && steps[i].label) {
                    steps[i].icon.classList.remove('bg-gray-600', 'text-gray-300');
                    steps[i].icon.classList.add('bg-primary', 'text-white');
                    steps[i].label.classList.remove('text-gray-400');
                    steps[i].label.classList.add('text-primary', 'font-medium');
                    // Update the line after this step (if not the last step)
                    if (i < steps.length - 1) {
                        const nextLine = steps[i].icon.closest('.flex').nextElementSibling.querySelector('.h-1');
                        if (nextLine) {
                            nextLine.classList.remove('bg-gray-600');
                            nextLine.classList.add('bg-primary');
                        }
                    }
                }
            }
        }

        function showStep(step) {
            document.querySelectorAll('.wizard-section').forEach(section => section.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            document.getElementById('prevButton').disabled = step === 1;
            document.getElementById('nextButton').classList.toggle('hidden', step === totalSteps);
            document.getElementById('submitButton').classList.toggle('hidden', step !== totalSteps);
            currentStep = step;
            updateProgressSteps(step);
        }
        
        // ATS Compatibility Score
        function updateAtsScore() {
            let score = 0;
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim();
            const summary = document.getElementById('summary').value.trim();
            let totalAchievements = 0;
            let hasQuantifiable = false;
            document.querySelectorAll('.exp-achievements').forEach(textarea => {
                const achievements = textarea.value.split('\n').filter(line => line.trim());
                totalAchievements += achievements.length;
                achievements.forEach(ach => {
                    if (/\d+%?|\$\d+|\d+\s(million|thousand|billion|%)|improved|increased|decreased|reduced|saved|grew|generated|managed/i.test(ach)) {
                        hasQuantifiable = true;
                    }
                });
            });
            let totalSkills = 0;
            document.querySelectorAll('#techSkillsContainer .skill-item').forEach(item => {
                totalSkills++;
            });
            document.querySelectorAll('#softSkillsContainer .skill-item').forEach(item => {
                totalSkills++;
            });
            if (fullName) score += 20;
            if (email) score += 10;
            if (summary.length > 50) score += 15;
            if (totalSkills > 3) score += 15;
            if (totalAchievements > 2) score += 20;
            if (hasQuantifiable) score += 20;
            document.getElementById('atsScore').textContent = `${score}/100`;
            document.getElementById('atsScore').className = score >= 80 ? 'font-bold text-green-500' : score >= 50 ? 'font-bold text-yellow-500' : 'font-bold text-red-500';
            // Update Skills ATS Score
            const skillsScore = Math.min(totalSkills * 10, 100);
            document.getElementById('skillsAtsScore').textContent = `${skillsScore}%`;
            document.getElementById('skillsAtsScoreBar').style.width = `${skillsScore}%`;
        }

        // Smart Suggestion Chips
        /*function generateSuggestions(inputId, value) {
            const suggestions = {
                fullName: ['John Doe', 'Jane Smith'],
                email: ['example@gmail.com', 'contact@domain.com'],
                phone: ['+1 (555) 123-4567', '(555) 987-6543'],
                linkedin: ['linkedin.com/in/johndoe', 'linkedin.com/in/janesmith'],
                portfolio: ['portfolio.com/johndoe', 'github.com/janesmith'],
                summary: ['Results-driven professional with 5+ years in...', 'Skilled engineer specializing in...'],
                'exp-title': ['Software Engineer', 'Project Manager', 'Data Analyst'],
                'exp-company': ['Google', 'Microsoft', 'Amazon'],
                'exp-location': ['New York, NY', 'San Francisco, CA'],
                'exp-achievements': ['Increased revenue by 20%...', 'Led a team of 10 to deliver...'],
                'edu-degree': ['Bachelor of Science', 'Master of Business Administration'],
                'edu-institution': ['MIT', 'Stanford University'],
                'edu-major': ['Computer Science', 'Business Administration'],
                certifications: ['PMP', 'AWS Certified Solutions Architect'],
                projects: ['Developed a web app using React...', 'Led a data analysis project...']
            };
            const jobDesc = document.getElementById('jobDescription').value;
            let jobKeywords = getKeywordSuggestions(jobDesc);
            const fieldSuggestions = suggestions[inputId] || jobKeywords.slice(0, 5);
            const suggestionDiv = document.getElementById(`${inputId}Suggestions`) || document.querySelector(`.${inputId}-suggestions`);
            if (suggestionDiv) {
                suggestionDiv.innerHTML = fieldSuggestions.map(s => `<span class="suggestion-chip" onclick="applySuggestion('${inputId}', '${escapeHTML(s)}')">${escapeHTML(s)}</span>`).join('');
            }
        }
        
        
        function applySuggestion(inputId, suggestion) {
            const input = document.getElementById(inputId) || document.querySelector(`.${inputId}`);
            if (input.tagName === 'TEXTAREA' && inputId.includes('achievements')) {
                input.value += (input.value ? '\n' : '') + suggestion;
            } else if (input.tagName === 'TEXTAREA') {
                const current = input.value.split(',').map(s => s.trim()).filter(s => s);
                if (!current.includes(suggestion)) {
                    current.push(suggestion);
                    input.value = current.join(', ');
                }
            } else {
                input.value = suggestion;
            }
            input.dispatchEvent(new Event('input'));
        }*/

        // Keyword Suggestions
        function getKeywordSuggestions(jobDescription) {
            if (!jobDescription) return [];
            const words = jobDescription.toLowerCase().split(/\W+/).filter(word => word.length > 2).filter(word => !['the', 'and', 'for', 'with', 'you', 'your', 'from', 'have', 'are', 'this', 'that', 'will', 'must', 'can', 'may', 'required', 'skills', 'experience', 'ability', 'develop', 'manage', 'strong', 'work', 'team', 'build', 'design', 'implement', 'technical', 'support', 'solution', 'responsible'].includes(word));
            const wordCounts = {};
            words.forEach(word => { wordCounts[word] = (wordCounts[word] || 0) + 1; });
            return Object.entries(wordCounts).sort(([, countA], [, countB]) => countB - countA).slice(0, 10).map(([word]) => word);
        }

        // Add Experience Block
        function addExperienceBlock() {
            const container = document.getElementById('experienceContainer');
            const newBlock = document.createElement('div');
            newBlock.className = 'experience-item p-4 border border-green-700 rounded-md bg-gray-900';
            newBlock.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                    <input type="text" class="exp-title input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Job Title" required>
                    <div class="exp-title-suggestions mt-2"></div>
                    <input type="text" class="exp-company input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Company Name" required>
                    <div class="exp-company-suggestions mt-2"></div>
                    <input type="text" class="exp-location input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Location (City, State/Country)">
                    <div class="exp-location-suggestions mt-2"></div>
                    <div class="flex gap-2">
                        <input type="month" class="exp-start-date input-field p-3 border border-gray-600 rounded-md w-1/2 bg-gray-900 text-gray-200" placeholder="Start Date (MM/YYYY)" required>
                        <input type="month" class="exp-end-date input-field p-3 border border-gray-600 rounded-md w-1/2 bg-gray-900 text-gray-200" placeholder="End Date (MM/YYYY) or Present" required>
                    </div>
                </div>
                <textarea class="exp-achievements input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" rows="4" placeholder="Describe 3-5 key achievements with quantifiable results. One per line." required></textarea>
                <div class="exp-achievements-suggestions mt-2"></div>
                <button type="button" class="remove-exp-btn mt-2 px-3 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">Remove Experience</button>
            `;
            container.appendChild(newBlock);
            newBlock.querySelector('.remove-exp-btn').addEventListener('click', () => newBlock.remove());
            attachInputListeners(newBlock);
            updateAtsScore();
        }

        // Add Education Block
        function addEducationBlock() {
            const container = document.getElementById('educationContainer');
            const newBlock = document.createElement('div');
            newBlock.className = 'education-item p-4 border border-purple-700 rounded-md bg-gray-900';
            newBlock.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                    <input type="text" class="edu-degree input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Degree/Certificate" required>
                    <div class="edu-degree-suggestions mt-2"></div>
                    <input type="text" class="edu-institution input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Institution Name" required>
                    <div class="edu-institution-suggestions mt-2"></div>
                    <input type="text" class="edu-major input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Major/Field of Study">
                    <div class="edu-major-suggestions mt-2"></div>
                    <input type="month" class="edu-grad-date input-field p-3 border border-gray-600 rounded-md w-full bg-gray-900 text-gray-200" placeholder="Graduation Date (MM/YYYY) or Expected" required>
                </div>
                <button type="button" class="remove-edu-btn mt-2 px-3 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">Remove Education</button>
            `;
            container.appendChild(newBlock);
            newBlock.querySelector('.remove-edu-btn').addEventListener('click', () => newBlock.remove());
            attachInputListeners(newBlock);
            updateAtsScore();
        }

        // Technical Skills Management
        function addTechSkill() {
            const category = document.getElementById('techSkillCategory').value;
            const skill = document.getElementById('techSkillInput').value.trim();
            if (!skill) return;
            const container = document.getElementById('techSkillsContainer');
            const skillItem = document.createElement('div');
            skillItem.className = 'skill-item';
            skillItem.draggable = true;
            skillItem.innerHTML = `
                <span>${escapeHTML(skill)} (${escapeHTML(category)})</span>
                <div class="star-rating">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
                <button type="button" class="remove-skill-btn px-2 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">Remove</button>
            `;
            container.appendChild(skillItem);
            document.getElementById('techSkillInput').value = '';
            skillItem.querySelector('.remove-skill-btn').addEventListener('click', () => {
                skillItem.remove();
                updateSkillsForResume();
                updateAtsScore();
            });
            skillItem.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', () => {
                    const value = parseInt(star.dataset.value);
                    skillItem.querySelectorAll('.star').forEach(s => {
                        s.classList.toggle('filled', parseInt(s.dataset.value) <= value);
                    });
                    updateSkillsForResume();
                    updateAtsScore();
                });
            });
            setupDragAndDrop(container);
            updateSkillsForResume();
            updateAtsScore();
        }

        // Soft Skills Management
        function addSoftSkill() {
            const selectSkill = document.getElementById('softSkillSelect').value;
            const customSkill = document.getElementById('customSoftSkillInput').value.trim();
            const proficiency = document.getElementById('softSkillProficiency').value;
            const skill = selectSkill || customSkill;
            if (!skill) return;
            const container = document.getElementById('softSkillsContainer');
            const skillItem = document.createElement('div');
            skillItem.className = 'skill-item';
            skillItem.innerHTML = `
                <span>${escapeHTML(skill)} (${escapeHTML(proficiency)})</span>
                <button type="button" class="remove-skill-btn px-2 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">Remove</button>
            `;
            container.appendChild(skillItem);
            document.getElementById('softSkillSelect').value = '';
            document.getElementById('customSoftSkillInput').value = '';
            skillItem.querySelector('.remove-skill-btn').addEventListener('click', () => {
                skillItem.remove();
                updateSkillsForResume();
                updateAtsScore();
            });
            updateSkillsForResume();
            updateAtsScore();
        }

        // Drag and Drop for Technical Skills
        function setupDragAndDrop(container) {
            container.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('skill-item')) {
                    e.target.classList.add('dragging');
                }
            });
            container.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('skill-item')) {
                    e.target.classList.remove('dragging');
                }
            });
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) {
                    container.appendChild(draggable);
                } else {
                    container.insertBefore(draggable, afterElement);
                }
                updateSkillsForResume();
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.skill-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Update Skills for Resume
        function updateSkillsForResume() {
            const techSkills = [];
            document.querySelectorAll('#techSkillsContainer .skill-item').forEach(item => {
                const skillText = item.querySelector('span').textContent;
                const stars = item.querySelectorAll('.star.filled').length;
                techSkills.push(`${skillText} (${stars}/5)`);
            });
            const softSkills = [];
            document.querySelectorAll('#softSkillsContainer .skill-item').forEach(item => {
                const skillText = item.querySelector('span').textContent;
                softSkills.push(skillText);
            });
            const allSkills = [...techSkills, ...softSkills].join(', ');
            const skillsInput = document.getElementById('skills');
            if (skillsInput) {
                skillsInput.value = allSkills;
                skillsInput.dispatchEvent(new Event('input'));
            }
        }

        // Generate Resume Content
        async function generateResumeContentCore() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const linkedin = document.getElementById('linkedin').value;
            const portfolio = document.getElementById('portfolio').value;
            const summary = document.getElementById('summary').value;
            const skills = document.getElementById('skills') ? document.getElementById('skills').value : '';
            const certifications = document.getElementById('certifications').value;
            const projects = document.getElementById('projects').value;
            const experiences = [];
            document.querySelectorAll('.experience-item').forEach(item => {
                const title = item.querySelector('.exp-title').value;
                const company = item.querySelector('.exp-company').value;
                const location = item.querySelector('.exp-location').value;
                const startDate = item.querySelector('.exp-start-date').value;
                const endDate = item.querySelector('.exp-end-date').value;
                const achievements = item.querySelector('.exp-achievements').value.split('\n').filter(line => line.trim());
                if (title && company) {
                    experiences.push({ title, company, location, startDate, endDate, achievements });
                }
            });
            const educations = [];
            document.querySelectorAll('.education-item').forEach(item => {
                const degree = item.querySelector('.edu-degree').value;
                const institution = item.querySelector('.edu-institution').value;
                const major = item.querySelector('.edu-major').value;
                const gradDate = item.querySelector('.edu-grad-date').value;
                if (degree && institution) {
                    educations.push({ degree, institution, major, gradDate });
                }
            });

            let prompt = `Generate an ATS-friendly resume for a job applicant as a single continuous HTML block. Ensure it has a professional tone, is concise, and highlights achievements. Structure it clearly with sections for "Contact Information", "Summary", "Experience", "Education", "Skills", "Certifications", and "Projects". Use ONLY standard HTML formatting (p, h1, h2, ul, li, a tags) without any markdown, extra tags, or breaks. Do NOT include <script>, <head>, <body>, or <html> tags. Only provide the content within the main resume body as one cohesive HTML string. Ensure all links are standard HTML <a> tags.`;
            prompt += `\n\n--- Applicant Information ---`;
            prompt += `\nName: ${fullName}`;
            prompt += `\nEmail: ${email}`;
            if (phone) prompt += `\nPhone: ${phone}`;
            if (linkedin) prompt += `\nLinkedIn: ${linkedin}`;
            if (portfolio) prompt += `\nPortfolio: ${portfolio}`;
            if (summary) prompt += `\nSummary: ${summary}`;
            if (experiences.length > 0) {
                prompt += `\n\n--- Work Experience ---`;
                experiences.forEach(exp => {
                    prompt += `\n- Job Title: ${exp.title}`;
                    prompt += `\n  Company: ${exp.company}`;
                    if (exp.location) prompt += `\n  Location: ${exp.location}`;
                    prompt += `\n  Dates: ${exp.startDate} to ${exp.endDate}`;
                    if (exp.achievements.length > 0) {
                        prompt += `\n  Achievements:\n    * ${exp.achievements.join('\n    * ')}`;
                    }
                });
            }
            if (educations.length > 0) {
                prompt += `\n\n--- Education ---`;
                educations.forEach(edu => {
                    prompt += `\n- Degree: ${edu.degree}`;
                    prompt += `\n  Institution: ${edu.institution}`;
                    if (edu.major) prompt += `\n  Major: ${edu.major}`;
                    prompt += `\n  Graduation Date: ${edu.gradDate}`;
                });
            }
            if (skills) prompt += `\n\n--- Skills ---\nSkills: ${skills}`;
            if (certifications) prompt += `\n\n--- Certifications ---\nCertifications: ${certifications}`;
            if (projects) prompt += `\n\n--- Projects ---\nProjects: ${projects}`;

            const apiKey = "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";
            const apiUrl = "https://openrouter.ai/api/v1/chat/completions";
            try {
                const payload = {
                    model: "openai/gpt-4o-mini",
                    messages: [{ role: "user", content: prompt }],
                    max_tokens: 2000,
                    temperature: 0.7
                };
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} - ${errorData.error?.message || response.statusText}`);
                }
                const result = await response.json();
                if (result.choices && result.choices.length > 0 && result.choices[0].message.content) {
                    let aiGeneratedHtml = result.choices[0].message.content;
                    let cleanedHtml = aiGeneratedHtml
                        .replace(/```html\s*\n?|```/g, '')
                        .replace(/<style>[\s\S]*?<\/style>|<\/?head>|<\/?body>|<\/?html>/gi, '')
                        .trim();
                    if (!cleanedHtml || !/<[a-z][\s\S]*>/i.test(cleanedHtml)) {
                        console.warn("No valid HTML detected:", cleanedHtml);
                        return `<p class="text-red-500">Error: AI did not generate valid HTML.</p>`;
                    }
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(`<div>${cleanedHtml}</div>`, 'text/html');
                    doc.querySelectorAll('script, style, head, body, html').forEach(el => el.remove());
                    const divElement = doc.body ? doc.body.querySelector('div') : null;
                    if (divElement) {
                        cleanedHtml = divElement.innerHTML;
                    } else {
                        console.warn("No valid <div> found, using raw cleaned HTML:", cleanedHtml);
                        cleanedHtml = cleanedHtml;
                    }
                    if (!cleanedHtml || cleanedHtml.trim().length < 10) {
                        console.warn("AI returned empty or invalid HTML:", cleanedHtml);
                        return `<p class="text-red-500">Error: AI generated empty or invalid content.</p>`;
                    }
                    return cleanedHtml;
                } else {
                    console.error("Unexpected AI response:", result);
                    return `<p class="text-red-500">Error: AI did not return expected content.</p>`;
                }
            } catch (error) {
                console.error("Failed to generate resume:", error);
                return `<p class="text-red-500">Error generating resume: ${error.message}</p>`;
            }
        }

        // Live Preview Update
        async function updateLivePreview() {
            const livePreview = document.getElementById('livePreview');
            const template = document.querySelector('.template-option.active').dataset.template;
            const primaryColor = document.querySelector('.color-option.active').dataset.color;
            const fontFamily = document.getElementById('fontFamily').value;
            const fontSize = document.getElementById('fontSize').value;
            const lineSpacing = document.getElementById('lineSpacing').value;

            livePreview.innerHTML = `<div class="text-center text-gray-500 py-10"><div class="animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-3"></div><p>Generating preview...</p></div>`;

            try {
                const content = await generateResumeContentCore();
                let wrapper = document.createElement('div');
                wrapper.className = `resume-content-base template-${template}`;
                wrapper.style.fontFamily = fontFamily;
                wrapper.style.fontSize = `${fontSize}px`;
                wrapper.style.lineHeight = lineSpacing;
                wrapper.style.padding = '1in 0.75in';
                wrapper.style.maxWidth = '800px';
                wrapper.style.margin = '0 auto';
                wrapper.style.boxSizing = 'border-box';
                wrapper.innerHTML = content;
                wrapper.querySelectorAll('h1, h2, a').forEach(el => el.style.color = primaryColor);
                livePreview.innerHTML = '';
                livePreview.appendChild(wrapper);
            } catch (error) {
                livePreview.innerHTML = `<p class="text-center text-red-600 py-10">Failed to load preview: ${error.message}</p>`;
            }
        }

        // Download HTML
        async function downloadHtml() {
            const fullName = document.getElementById('fullName').value || 'Resume';
            const filename = `${fullName.replace(/\s+/g, '_')}_resume.html`;
            const content = await generateResumeContentCore();
            const template = document.querySelector('.template-option.active').dataset.template;
            const primaryColor = document.querySelector('.color-option.active').dataset.color;
            const fontFamily = document.getElementById('fontFamily').value;
            const fontSize = document.getElementById('fontSize').value;
            const lineSpacing = document.getElementById('lineSpacing').value;
            const layout = 'standard'; // Default layout

            const inlineCss = `
                body { font-family: ${fontFamily}, sans-serif; margin: 0; padding: 0; color: #333; }
                .resume-body { max-width: 8.5in; margin: 0 auto; padding: ${layout === 'compact' ? '0.5in' : layout === 'spacious' ? '1.5in' : '1in'}; background-color: white; box-sizing: border-box; font-size: ${fontSize}px; line-height: ${lineSpacing}; }
                .resume-content-base h1, .resume-content-base h2, .resume-content-base a { color: ${primaryColor}; }
                .resume-content-base h1 { font-weight: bold; margin-bottom: 0.25em; }
                .resume-content-base h2 { font-weight: bold; padding-bottom: 0.25em; margin-top: 1.5em; margin-bottom: 0.75em; }
                .resume-content-base p, .resume-content-base ul { font-size: 0.95em; line-height: 1.4; margin-bottom: 0.5em; }
                .resume-content-base ul { list-style-type: disc; margin-left: 1.5em; }
                .resume-content-base ul li { margin-bottom: 0.25em; }
                .resume-content-base .contact-info { font-size: 0.9em; color: #555; margin-bottom: 1em; }
                .resume-content-base .experience-item, .resume-content-base .education-item { margin-bottom: 1em; }
                .resume-content-base .job-title, .resume-content-base .company, .resume-content-base .degree, .resume-content-base .institution { font-weight: 600; }
                .resume-content-base .dates, .resume-content-base .location { font-size: 0.85em; color: #666; }
                .resume-content-base a { text-decoration: none; }
                .resume-content-base a:hover { text-decoration: underline; }
                .template-modern h1 { font-size: 1.8em; text-align: center; }
                .template-modern h2 { font-size: 1.2em; border-bottom: 2px solid ${primaryColor}; }
                .template-modern .contact-info { text-align: center; }
                .template-classic h1 { font-size: 1.9em; text-transform: uppercase; letter-spacing: 0.05em; text-align: left; border-bottom: 1px solid #ccc; padding-bottom: 0.5em; margin-bottom: 1em; }
                .template-classic h2 { font-size: 1.1em; border-bottom: 1px solid #ccc; text-align: left; text-transform: uppercase; }
                .template-classic .contact-info { text-align: left; margin-bottom: 0.5em; }
                .template-classic .experience-item, .template-classic .education-item { border-left: 3px solid #ddd; padding-left: 10px; margin-left: 5px; }
                .template-classic ul { list-style-type: square; }
                .template-minimalist h1 { font-size: 1.8em; text-align: center; margin-bottom: 0.5em; }
                .template-minimalist h2 { font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; border-bottom: none; text-transform: uppercase; letter-spacing: 0.03em; }
                .template-minimalist .contact-info { text-align: center; font-size: 0.85em; margin-bottom: 1.5em; }
                .template-minimalist p, .template-minimalist ul { font-size: 0.9em; }
                .template-minimalist ul { list-style-type: none; margin-left: 0; padding-left: 1.5em; }
                .template-minimalist ul li::before { content: '– '; margin-left: -1em; display: inline-block; width: 1em; }
                .template-minimalist .experience-item, .template-minimalist .education-item { margin-bottom: 1.2em; }
                .template-minimalist .job-title, .template-minimalist .degree { font-weight: 700; }
                .template-minimalist .company, .template-minimalist .institution { font-weight: normal; font-style: italic; }
                .template-minimalist .dates, .template-minimalist .location { color: #777; font-size: 0.8em; margin-top: 0.2em; }
            `;
            const htmlDocument = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${fullName} - Resume</title>
                    <style>${inlineCss}</style>
                </head>
                <body>
                    <div class="resume-body resume-content-base template-${template}">
                        ${content}
                    </div>
                </body>
                </html>
            `;
            const blob = new Blob([htmlDocument], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }

        // Copy for Word
        async function copyForWord() {
            const content = await generateResumeContentCore();
            const template = document.querySelector('.template-option.active').dataset.template;
            const tempDiv = document.createElement('div');
            tempDiv.className = `resume-content-base template-${template}`;
            tempDiv.style.width = '8.5in';
            tempDiv.style.padding = '1in 0.75in';
            tempDiv.style.boxSizing = 'border-box';
            tempDiv.style.fontFamily = document.getElementById('fontFamily').value;
            tempDiv.innerHTML = content;
            document.body.appendChild(tempDiv);
            const range = document.createRange();
            range.selectNode(tempDiv);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try {
                document.execCommand('copy');
                showToast('Resume copied to clipboard! Paste into Word/Docs.', 'bg-green-500');
            } catch (err) {
                showToast('Failed to copy. Please select and copy manually.', 'bg-red-600');
            } finally {
                window.getSelection().removeAllRanges();
                document.body.removeChild(tempDiv);
            }
        }

        // ATS Compatibility Check
        function checkAtsContent() {
            const analysisResultsDiv = document.getElementById('atsAnalysisResults');
            let resultsHtml = '<h4>Analysis of Your Inputs:</h4><ul>';
            const summary = document.getElementById('summary').value.trim();
            if (summary.length > 50) {
                resultsHtml += `<li><span class="status-good">✓</span> Summary: Found.</li>`;
            } else {
                resultsHtml += `<li><span class="status-warning">!</span> Summary: Too short. Add a 2-3 sentence summary.</li>`;
            }
            let foundQuantifiable = false;
            let totalAchievements = 0;
            document.querySelectorAll('.exp-achievements').forEach(textarea => {
                const achievements = textarea.value.split('\n').filter(line => line.trim());
                totalAchievements += achievements.length;
                achievements.forEach(ach => {
                    if (/\d+%?|\$\d+|\d+\s(million|thousand|%)|improved|increased|reduced|saved/gi.test(ach)) {
                        foundQuantifiable = true;
                    }
                });
            });
            if (totalAchievements > 0) {
                if (foundQuantifiable) {
                    resultsHtml += `<li><span class="status-good">✓</span> Achievements: Quantifiable metrics detected.</li>`;
                } else {
                    resultsHtml += `<li><span class="status-warning">!</span> Achievements: No metrics found. Quantify impact (e.g., "Increased sales by 15%").</li>`;
                }
            } else {
                resultsHtml += `<li><span class="status-bad">X</span> Achievements: None entered.</li>`;
            }
            let totalSkills = document.querySelectorAll('#techSkillsContainer .skill-item').length + document.querySelectorAll('#softSkillsContainer .skill-item').length;
            if (totalSkills > 2) {
                resultsHtml += `<li><span class="status-good">✓</span> Skills: Sufficiently populated.</li>`;
            } else {
                resultsHtml += `<li><span class="status-warning">!</span> Skills: Too few. Add more relevant skills.</li>`;
            }
            resultsHtml += `<li><span class="status-good">✓</span> Headings: Standard and ATS-friendly.</li>`;
            resultsHtml += `<li><span class="status-good">✓</span> Formatting: Simple and ATS-compatible.</li>`;
            resultsHtml += '</ul><p class="text-sm text-gray-600 mt-2"><em>Basic ATS check. Tailor to job description for best results.</em></p>';
            analysisResultsDiv.innerHTML = resultsHtml;
            document.getElementById('atsModalOverlay').classList.add('visible');
        }

        // Toast Notification
        function showToast(message, bgColor) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
                ${bgColor}; color: white; padding: 10px 20px; border-radius: 5px;
                z-index: 1000; opacity: 0; transition: opacity 0.3s;
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.style.opacity = '1', 10);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Attach Input Listeners
        function attachInputListeners(container = document) {
            const inputs = container.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    const id = input.id || input.className.split(' ').find(c => c.includes('-'));
                    generateSuggestions(id, input.value);
                    updateAtsScore();
                    updateLivePreview();
                });
            });
        }

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('navbarMenu');
            menu.classList.toggle('active');
        }

        // Initialize Event Listeners
        function initializeEventListeners() {
            // Navigation Buttons
            document.getElementById('nextButton').addEventListener('click', () => {
                if (currentStep < totalSteps) showStep(currentStep + 1);
            });
            document.getElementById('prevButton').addEventListener('click', () => {
                if (currentStep > 1) showStep(currentStep - 1);
            });
            
            // Form Submission
            document.getElementById('resumeForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await updateLivePreview();
                showToast('Resume generated successfully!', 'bg-green-500');
            });
            
            // Experience Management
            document.getElementById('addExperienceBtn').addEventListener('click', addExperienceBlock);
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-exp-btn')) {
                    e.target.closest('.experience-item').remove();
                    updateAtsScore();
                    updateLivePreview();
                }
            });
            
            // Education Management
            document.getElementById('addEducationBtn').addEventListener('click', addEducationBlock);
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-edu-btn')) {
                    e.target.closest('.education-item').remove();
                    updateAtsScore();
                    updateLivePreview();
                }
            });
            
            // Skills Management
            document.getElementById('addTechSkillBtn').addEventListener('click', addTechSkill);
            document.getElementById('addSoftSkillBtn').addEventListener('click', addSoftSkill);
            
            // Job Description Analysis
            document.getElementById('jobDescription').addEventListener('input', (e) => {
                const keywords = getKeywordSuggestions(e.target.value);
                if (keywords.length > 0) {
                    const suggestionsDiv = document.getElementById('keywordSuggestions');
                    suggestionsDiv.classList.remove('hidden');
                    document.getElementById('suggestedKeywordsList').innerHTML = 
                        keywords.map(k => `<span class="suggestion-chip" onclick="document.getElementById('jobDescription').value += ' ${k}'">${k}</span>`).join('');
                }
            });
            
            // Preview Customization
            document.querySelectorAll('.template-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.template-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('templateSelector').value = this.dataset.template;
                    updateLivePreview();
                });
            });
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('primaryColor').value = this.dataset.color;
                    updateLivePreview();
                });
            });
            
            document.getElementById('fontFamily').addEventListener('change', updateLivePreview);
            document.getElementById('fontSize').addEventListener('input', updateLivePreview);
            document.getElementById('lineSpacing').addEventListener('input', updateLivePreview);
            
            // Download Buttons
            document.getElementById('downloadHtmlBtn').addEventListener('click', downloadHtml);
            document.getElementById('copyForWordBtn').addEventListener('click', copyForWord);
            document.getElementById('checkAtsBtn').addEventListener('click', checkAtsContent);
            
            // ATS Modal
            document.getElementById('closeAtsModal').addEventListener('click', () => {
                document.getElementById('atsModalOverlay').classList.remove('visible');
            });
            
            // Mobile Menu
            document.getElementById('mobileMenuToggle').addEventListener('click', toggleMobileMenu);
            
            // Initialize drag and drop for skills
            setupDragAndDrop(document.getElementById('techSkillsContainer'));
            
            // Attach input listeners to all form fields
            attachInputListeners();
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            showStep(1);
            updateAtsScore();
            
            // Add initial experience and education blocks
            addExperienceBlock();
            addEducationBlock();
            
            // Set up a debounced preview update
            let previewTimeout;
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('input', () => {
                    clearTimeout(previewTimeout);
                    previewTimeout = setTimeout(updateLivePreview, 1000);
                });
            });
        });
    </script>
</body>
</html>